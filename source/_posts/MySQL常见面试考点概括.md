---
title: MySQL常见知识点概括
date: 2018-07-12 15:21:58
tags: MySQl
---

### 存储引擎

1. InnoDB
   - 默认事务型
   - 数据储存在共享表空间，可以通过配置分开
   - 主键查询性能高于其他引擎
   - 内部做了很多优化，词谱读取数据时自动在内存中构建 hash 索引
   - 插入数据自动插入缓冲区
   - 支持真正的热备份
   - 支持崩溃后安全回复
   - 支持行锁
   - 支持外键
2. MyISAM
   - 支持全文索引（很少使用，只支持英文）
   - 支持数据压缩
   - 支持空间函数
   - 表锁
   - 表数据存储在 MYD、MYI 两个文件中 方便数据迁移
   - 设计简单，某些场景下性能很好
3. 其他存储引擎
   - Archive
   - Blackhole
   - CSV
   - Memory

### 事务处理

1. MySQL 提供事务处理的引擎 innoDB
2. 事务由存储引擎实现，所以在同一个事务中使用多种存储引擎不可行
3. 在非事务表中执行事务操作，不会提醒也不会报错

### 存储过程

1. 一条或多条 sql 语句的集合
2. 存储过程就是业务逻辑和流程的集合
3. 不推荐使用，会造成系统维护灾难

### 触发器

1. 可以保证数据的完整性
2. 不推荐使用，会造成系统维护灾难

### 索引

1. 小表全表扫描效率更高，占用空间，降低写操作性能。
2. 特大型表，建立和使用索引的代价会随着数据量增长而增加，可以使用分区技术解决。
3. 索引都是在存储引擎层实现的。
4. 索引类型
   - 普通索引: 基本索引，无约束限制
   - 唯一索引: 具有唯一性约束，允许为空
   - 主键索引: 特殊的唯一索引，不允许为空
5. 唯一索引和主键索引的区别：
   - 一直表有且只能有一个主键索引，可以有多个唯一索引
   - 主键索引一定是唯一索引，但唯一索引不一定是主键索引
   - 主键可以与外键构成参照完整性约束，防止数据不一致
6. 外键索引: 只有 InnoDB 支持，可以保证数据一致性，完整性，和实现级联操作
7. 全文索引
   - 只能用于 MyISAM
   - 只支持英文（可使用其他搜索引擎，如 Sphinx、elasticsearch 等）
8. 索引使用原则
   - 最适合索引的列是 where 或 on 后面的列
   - 索引的基数越大，效果越好
   - 字符串索引，指定前缀长度，可以节省大量的索引占用空间
   - 避免建立过多的索引，会导致占用磁盘空间，降低写操作性能
   - 主键应当选择比较短的数据类型，可以有效的提高查询效率
9. SQL 查询优化

   1. 索引使用
      - 前缀原则
      - like 查询，%不能再前，可以使用全文索引或其他搜索引擎
      - column is null 可以使用索引
      - MySQL 会根据数据量自动选择是否使用索引
      - or 查询条件中注意前后的条件都必须有有索引
      - 数据类型为字符串时，查询值不加引号，会使索引失效
      - 使用连接查询代替子查询 （子查询效率很低）
   2. 记录慢查询日志

      ```sql
      show profile
      set profiling = 1
      show profiles
      show profile for query # 临时表ID
      explain or desc sql
      show processlist
      ```

   3. 将复杂的 sql 分拆成多个简单查询 可以更方便做数据缓存
   4. 如果不需要使用 ORDER BY 进行 GROUP BY 时可是使用 ORDER BY NULL，MySQL 不会进行文件排序，可以调高查询效率
   5. limit 偏移量大的时候，可以添加上次查询结果最大的 id 作为条件以提高查询效率

### 分区分表分库

1. 分区
   - ID 切分
   - 时间切分
2. 分表
   - 水平切分
   - 垂直切分
3. 分库
   - 水平切分
   - 垂直切分

### 主从复制

1. 二进制日志
   - 数据同步
   - 操作同步
   - 混合同步

### 安全问题

1. 使用预处理语句防止 sql 注入 PDO
1. 转义特殊字符
1. 查询错误处理
1. 定期做数据备份
1. 合理分配权限，限制普通用户浏览其他数据库
1. 关闭远程链接权限
1. 修改 root 用户密码，不适用弱口令
1. 删除不需要的用户
1. 限制访问数据库文件
